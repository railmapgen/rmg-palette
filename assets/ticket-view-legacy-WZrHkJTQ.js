System.register(["./mantine-legacy-D-BSHsMm.js","./react-legacy-Bkm4g_oU.js","./index-legacy-CRKk273c.js","./use-translated-name-legacy-BZLNJKPV.js","./pantone-input-legacy-B7ogVdNR.js","./palette-card.module-legacy-C_mIYdI3.js"],(function(e,t){"use strict";var n,a,s,l,r,o,i,c,d,u,h,x,g,j,p,m,v,b,y,f,C,w,k,S,L,z,E,R,_,P,I,N,T,O,U,D,M,A,F,J,$,B,V,q,G,Y,K,Z,H,W,Q,X,ee,te,ne,ae,se,le,re,oe,ie,ce,de,ue,he,xe,ge,je,pe,me,ve,be,ye,fe,Ce,we,ke,Se,Le,ze,Ee;return{setters:[e=>{n=e.j,a=e.o,s=e.F,l=e.G,r=e.N,o=e.p,i=e.n,c=e.q,d=e.g,u=e.e,h=e.h,x=e.T,g=e.r,j=e.s,p=e.f,m=e.t,v=e.v,b=e.b,y=e.d,f=e.w,C=e.L,w=e.D},e=>{k=e.l,S=e.r},e=>{L=e.L,z=e.d,E=e.e,R=e.f,_=e.u,P=e.g,I=e.h,N=e.i,T=e.j,O=e.k,U=e.l,D=e.m,M=e.n,A=e.o,F=e.p,J=e.q,$=e.t,B=e.v,V=e.w,q=e.x,G=e.y,Y=e.M,K=e.z,Z=e.A,H=e.a,W=e.B,Q=e.C,X=e.D,ee=e.F,te=e.G,ne=e.H,ae=e.I,se=e.J,le=e.K,re=e.N,oe=e.O,ie=e.P,ce=e.Q,de=e.S,ue=e.T,he=e.U,xe=e.V,ge=e.W,je=e.X,pe=e.Y,me=e.r,ve=e.Z,be=e._,ye=e.$,fe=e.b,Ce=e.c,we=e.a0,ke=e.E},e=>{Se=e.u},e=>{Le=e.P,ze=e.a},e=>{Ee=e.c}],execute:function(){var t=document.createElement("style");t.textContent="._content_euz2o_1,._body_euz2o_7,._stepper-root_euz2o_14,._stepper-content_euz2o_21{display:flex;flex-direction:column;overflow:hidden}._step-body_euz2o_28{overflow-y:auto}\n/*$vite$:1*/",document.head.appendChild(t),e("default",(function(){const{t:e}=k(),t=R(),{isDataLoading:a}=_((e=>e.app)),[s,r]=S.useState(),[o,i]=S.useState(!1),[c,d]=S.useState(!1);return S.useEffect((()=>{const e=me.storage.get(ve);if(e)try{const t=JSON.parse(e);Object.keys(t.lines).length>0&&Object.values(t.lines)[0].id&&(r(t),i(!0))}catch{ye.error("<TicketView/>, unable to restore draft ticket",e)}}),[]),n.jsxs(fe,{w:{base:"100%",sm:600},style:{alignSelf:"center"},children:[n.jsx(C,{visible:a}),n.jsxs(Ce,{direction:"column",px:"xs",style:{overflowY:"auto"},children:[n.jsx(Pe,{}),n.jsx(Ie,{}),n.jsx(Te,{})]}),n.jsx(w,{}),n.jsx(we,{children:n.jsxs(l,{flex:1,gap:"sm",children:[n.jsx(p,{variant:"default",onClick:()=>{me.openApp({appId:"rmg-palette"})},children:e("Go back")}),n.jsx(p,{variant:"default",ml:"auto",onClick:()=>{t(be()),me.storage.remove(ve),me.event(ke.RESET_TICKET,{})},children:e("Reset")}),n.jsx(p,{onClick:()=>d(!0),children:e("Submit")})]})}),n.jsx(Je,{isOpen:o,onClose:()=>i(!1),incomingState:s}),n.jsx(Fe,{isOpen:c,onClose:()=>d(!1)})]})}));const Re=e=>{const{onUpdate:t,onLangSwitch:d,onRemove:u}=e,h=e.entries??[],{t:x}=k(),g=Se(),j=Object.entries(L).map((([e,t])=>({value:e,label:g(t),disabled:h.some((t=>t[0]===e))}))),p=()=>{const e=Object.keys(L).filter((e=>!h.find((t=>t[0]===e))))[0];t(e,"")};return n.jsx(a,{legend:x("Multi-languages"),children:h.map((([e,a],h,g)=>n.jsxs(s,{pt:4,align:"center","data-testid":"entry-card-stack-"+e,children:[n.jsxs(l,{gap:"xs",flex:1,grow:!0,children:[n.jsx(r,{size:"xs","aria-label":x("Language"),value:e,onChange:({currentTarget:{value:t}})=>d(e,t),data:j}),n.jsx(o,{size:"xs","aria-label":x("Name"),placeholder:x("Enter name"),value:a,onChange:({currentTarget:{value:n}})=>t(e,n)})]}),n.jsxs(s,{ml:8,wrap:"nowrap",children:[h===g.length-1?n.jsx(i,{size:"sm",variant:"filled","aria-label":x("Add a name in another language"),title:x("Add a name in another language"),onClick:p,children:n.jsx(z,{})}):n.jsx(c,{w:22}),g.length>1&&n.jsx(i,{size:"sm",variant:"outline","aria-label":x("Remove this name"),title:x("Remove this name"),onClick:()=>u(e),ml:4,children:n.jsx(E,{})})]})]},h)))})};function _e(e){return n.jsx(Re,{...e})}function Pe(){const{t:e,i18n:t}=k(),a=Se(),s=R(),{countryList:i}=_((e=>e.app)),{country:c,newCountry:h,countryName:x,newCountryLang:g}=_((e=>e.ticket)),j=[{value:"",label:e("Please select..."),disabled:!0},...i.filter((e=>"UN"!==e.id)).map((e=>({value:e.id,label:a(e.name)}))).toSorted(((e,n)=>e.label.localeCompare(n.label,t.languages[0]))),{value:"new",label:e("Add a country/region...")}],p=Object.entries(L).map((([e,t])=>({value:e,label:a(t)})));return n.jsxs(P,{children:[n.jsx(I,{children:n.jsx(d,{order:2,size:"h4",children:e("Country/Region")})}),n.jsxs(u,{py:4,gap:"xs",children:[n.jsxs(l,{align:"flex-start",grow:!0,children:[n.jsx(r,{label:e("Country/Region"),value:c,onChange:({currentTarget:{value:e}})=>s(N(e)),data:j}),"new"===c&&n.jsx(o,{label:e("Country/region code"),placeholder:"e.g. CN, HK, JP (ISO 3166-1 alpha-2)",value:h,onChange:({currentTarget:{value:e}})=>s(T(e)),error:h&&!h.match(/^[A-Z]{2}$|^GB[A-Z]{3}$/)?e("Country code should be in the format of ISO 3166-1 alpha-2"):void 0}),"new"===c&&n.jsx(r,{label:e("Official language"),value:g,onChange:({currentTarget:{value:e}})=>s(O(e||void 0)),data:p})]}),"new"===c&&n.jsx(_e,{entries:x,onUpdate:(e,t)=>s(M({lang:e,name:t})),onLangSwitch:(e,t)=>s(D({prevLang:e,nextLang:t})),onRemove:e=>s(U(e))})]})]})}function Ie(){const{t:e,i18n:t}=k(),a=R(),s=Se(),{cityList:i}=_((e=>e.app)),{country:c,city:h,newCity:x,cityName:g}=_((e=>e.ticket)),j=[{value:"",label:e("Please select..."),disabled:!0},...i.filter((e=>e.country===c)).map((e=>({value:e.id,label:s(e.name)}))).toSorted(((e,n)=>e.label.localeCompare(n.label,t.languages[0]))),{value:"new",label:e("Add a city")+"..."}];return n.jsxs(P,{children:[n.jsx(I,{children:n.jsx(d,{order:2,size:"h4",children:e("City")})}),n.jsxs(u,{py:4,gap:"xs",children:[n.jsxs(l,{align:"flex-start",grow:!0,children:[n.jsx(r,{label:e("City"),value:h,onChange:({currentTarget:{value:e}})=>(async e=>{if("new"===e)return void a(B("new"));const t=await V(e,i);a(t?q(t):G())})(e),data:j}),"new"===h&&n.jsx(o,{label:e("City code"),placeholder:"e.g. hongkong, guangzhou, shanghai",value:x,onChange:({currentTarget:{value:e}})=>a(A(e)),error:x&&x.match(/[^a-z]/)?"City code should contain lower case letters only":void 0})]}),"new"===h&&n.jsx(_e,{entries:g,onUpdate:(e,t)=>a($({lang:e,name:t})),onLangSwitch:(e,t)=>a(J({prevLang:e,nextLang:t})),onRemove:e=>a(F(e))})]})]})}function Ne({lineDetail:e,onUpdate:t,onMoveUp:a,onMoveDown:s,onCopy:r,onRemove:c,onNameUpdate:d,onNameRemove:p,onLangSwitch:m}){const{t:v}=k(),b=Se(),{pantoneReady:y}=_((e=>e.app)),[f,C]=S.useState(!!e.pantone),[w,L]=S.useState(!1),z=S.useRef(null),R=[{label:v("Black"),value:Y.black},{label:v("White"),value:Y.white}],P=e.fg===Y.black?"black":"white";return n.jsxs(h,{ref:z,className:Ee.editable,p:"sm",withBorder:!0,children:[n.jsxs(h.Section,{bg:e.colour,p:"sm",className:Ee["card-section"],children:[n.jsx(x,{span:!0,style:{color:P},children:b(Object.fromEntries(e.nameEntity))}),n.jsxs(l,{gap:"xs",ml:"auto",children:[n.jsx(i,{size:"xs",variant:"subtle",color:P,"aria-label":v("Move up"),title:v("Move up"),onClick:a,children:n.jsx(K,{})}),n.jsx(i,{size:"xs",variant:"subtle",color:P,"aria-label":v("Move down"),title:v("Move down"),onClick:s,children:n.jsx(Z,{})}),n.jsx(i,{size:"xs",variant:"subtle",color:P,"aria-label":v("Edit"),title:v("Edit"),onClick:()=>{w?L(!1):(L(!0),setTimeout((()=>{z.current?.scrollIntoView({behavior:"smooth"})}),0))},children:n.jsx(H,{})}),n.jsx(i,{size:"xs",variant:"subtle",color:P,"aria-label":v("Duplicate"),title:v("Duplicate"),onClick:r,children:n.jsx(W,{})}),n.jsx(i,{size:"xs",variant:"subtle",color:P,"aria-label":v("Remove"),title:v("Remove"),onClick:c,children:n.jsx(E,{})})]})]}),w&&n.jsxs(u,{gap:"xs",mt:"xs",children:[n.jsxs(l,{gap:"xs",className:Ee["editable-group"],children:[n.jsx(o,{label:v("Line code"),placeholder:"e.g. twl, gz1, sh1",value:e.id,onChange:({currentTarget:{value:e}})=>t?.({id:e}),error:e.id?.match(/[^a-z0-9]/)?v("Line code should be alphanumeric"):void 0}),n.jsx(g,{label:v("Background colour"),value:e.colour,onChange:e=>t?.({colour:e}),disabled:y&&f}),y&&n.jsx(j,{label:v("Use PantoneÂ®"),checked:f,onChange:({currentTarget:{checked:e}})=>C(e),mt:"xl"}),y&&f&&n.jsx(Le,{value:e.pantone??"",onChange:(e,n)=>t?.({pantone:e,colour:n})}),n.jsx(Q,{size:"sm",label:v("Foreground colour"),data:R,value:e.fg,onChange:e=>t?.({fg:e})})]}),n.jsx(_e,{entries:e.nameEntity,onUpdate:(e,t)=>d?.(e,t),onLangSwitch:(e,t)=>m?.(e,t),onRemove:e=>p?.(e)})]})]})}function Te(){const{t:e}=k(),t=R(),a=_((e=>e.ticket.lines)),s=S.useRef(null),l=S.useCallback((()=>{setTimeout((()=>{s.current?.lastElementChild?.scrollIntoView({behavior:"smooth"})}),0)}),[s.current]);return n.jsxs(P,{children:[n.jsxs(I,{children:[n.jsx(d,{order:2,size:"h4",children:e("Lines")}),n.jsx(ze,{ml:"auto"})]}),n.jsxs(u,{ref:s,py:4,gap:"xs",children:[Object.entries(a).map((([e,a])=>n.jsx(Ne,{lineDetail:a,onUpdate:n=>t(le({entryId:e,updates:n})),onMoveUp:()=>t(se(e)),onMoveDown:()=>t(ae(e)),onCopy:()=>(e=>{t(re(e)),l()})(e),onRemove:()=>t(ne(e)),onNameUpdate:(n,a)=>t(te({entryId:e,lang:n,name:a})),onLangSwitch:(n,a)=>t(ee({entryId:e,prevLang:n,nextLang:a})),onNameRemove:n=>t(X({entryId:e,lang:n}))},e))),n.jsx(p,{size:"xs",variant:"outline",leftSection:n.jsx(z,{}),ml:"auto",onClick:()=>{t(oe()),l()},children:e("Add a line")})]})]})}const Oe={content:"_content_euz2o_1",body:"_body_euz2o_7","stepper-root":"_stepper-root_euz2o_14","stepper-content":"_stepper-content_euz2o_21","step-body":"_step-body_euz2o_28"};function Ue(e){const{countryErrors:t,cityErrors:a,lineErrors:s,onIgnore:r,onClose:o}=e,{t:i}=k(),c=Se();return n.jsxs(n.Fragment,{children:[n.jsxs(u,{gap:"xs",className:Oe["step-body"],children:[n.jsx(x,{children:i("Your inputs contain the following errors. Please consider fixing it before submitting.")}),t.length>0&&n.jsxs(n.Fragment,{children:[n.jsx(d,{order:3,size:"h5",children:i("Country/Region")}),n.jsx(m,{size:"sm",withPadding:!0,"aria-label":"List of country errors",children:t.map(((e,t)=>n.jsx(m.Item,{children:c(ie[e])},t)))})]}),a.length>0&&n.jsxs(n.Fragment,{children:[n.jsx(d,{order:3,size:"h5",children:i("City")}),n.jsx(m,{size:"sm",withPadding:!0,"aria-label":"List of city errors",children:a.map(((e,t)=>n.jsx(m.Item,{children:c(ie[e])},t)))})]}),Object.values(s).flat().length>0&&n.jsxs(n.Fragment,{children:[n.jsx(d,{order:3,size:"h5",children:i("Lines")}),n.jsx(m,{size:"sm",withPadding:!0,"aria-label":"List of line errors",children:Object.entries(s).map((([e,t])=>n.jsxs(m.Item,{children:[e,n.jsx(m,{size:"sm",withPadding:!0,children:t.map(((e,t)=>n.jsx(m.Item,{children:c(ie[e])},t)))})]},e)))})]})]}),n.jsxs(l,{gap:"sm",pt:"xs",children:[n.jsx(p,{variant:"default",ml:"auto",onClick:o,children:i("Go back")}),n.jsx(p,{onClick:r,children:i("Submit anyway")})]})]})}const De=e=>!!e.match(/^https?:\/\//)?.[0];function Me(e){const{dataSource:t,onDataSourceChange:a,refLink:s,onRefLinkChange:i,justification:c,onJustificationChange:d,onPrev:h,onNext:g}=e,{t:j}=k(),m=Se(),b=[{value:"",label:j("Please select..."),disabled:!0},...Object.entries(ce).map((([e,t])=>({value:e,label:m(t)})))],y=!(t&&s&&c&&De(s));return n.jsxs(n.Fragment,{children:[n.jsxs(u,{gap:"xs",className:Oe["step-body"],children:[n.jsx(x,{children:j("Please provide suitable source and justification.")}),n.jsx(r,{label:j("Data source"),value:t,onChange:({currentTarget:{value:e}})=>a(e),data:b}),n.jsx(o,{label:j("Reference link"),placeholder:j("Enter a valid URL, e.g.")+" https://en.wikipedia.org",value:s,onChange:({currentTarget:{value:e}})=>i(e),error:s&&!De(s)?j("URL is invalid"):void 0}),n.jsx(v,{label:j("Justification"),placeholder:j("Briefly describe your changes and provide justification"),value:c,onChange:({currentTarget:{value:e}})=>d(e),autosize:!0,minRows:3})]}),n.jsxs(l,{gap:"sm",pt:"xs",children:[h&&n.jsx(p,{variant:"default",onClick:h,leftSection:n.jsx(de,{}),children:j("Previous")}),n.jsx(p,{ml:"auto",onClick:g,rightSection:n.jsx(ue,{}),disabled:y,children:j("Next")})]})]})}function Ae(e){const{countryEntry:t,cityEntry:a,paletteList:s,dataSource:r,refLink:o,justification:i,onPrev:c}=e,{t:d}=k(),h=Se(),g=S.useRef(null),j=[`**Data source:** ${r?h(ce[r]):"(REPLACE ME)"}`,`**Reference link:** ${o||"(REPLACE ME)"}`,`**Justification:** ${i||"(REPLACE ME)"}`,he,xe("country",t),xe("city",a),xe("lines",s)].join("\n\n"),y=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:a?.name?.en??"[CITY]",body:j}),f=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:a?.name?.en??"[CITY]"});return n.jsxs(n.Fragment,{children:[n.jsxs(u,{gap:"xs",className:Oe["step-body"],children:[n.jsx(x,{children:d("If the button below doesn't work for you, please follow the instructions below:")}),n.jsxs(m,{type:"ordered",withPadding:!0,children:[n.jsxs(m.Item,{children:[d("Open")," ",n.jsxs(b,{href:"https://github.com/railmapgen/rmg-palette/issues/new?"+f.toString(),target:"_blank",children:["Issue: New Palettes Request ",n.jsx(ge,{})]})]}),n.jsxs(m.Item,{children:[d("Paste following text to the issue body")," ",n.jsx(p,{size:"xs",variant:"light",leftSection:n.jsx(W,{}),onClick:async()=>{g?.current&&(g.current.select(),await navigator.clipboard.writeText(j))},children:d("Copy")}),n.jsx(v,{ref:g,readOnly:!0,defaultValue:j,onClick:({target:e})=>e.select(),mt:"xs",autosize:!0,maxRows:3})]})]})]}),n.jsxs(l,{gap:"sm",pt:"xs",children:[n.jsx(p,{variant:"default",onClick:c,leftSection:n.jsx(de,{}),children:d("Previous")}),n.jsx(p,{ml:"auto",onClick:()=>window.open("https://github.com/railmapgen/rmg-palette/issues/new?"+y.toString(),"_blank"),children:d("1-click open issue")})]})]})}function Fe(e){const{isOpen:t,onClose:a}=e,{t:s}=k(),[l,r]=S.useState([]),[o,i]=S.useState([]),[c,d]=S.useState({}),[u,h]=S.useState(""),[x,g]=S.useState(""),[j,p]=S.useState(""),[m,v]=S.useState(!1),[b,C]=S.useState(!1),{countryList:w}=_((e=>e.app)),L=_((e=>e.ticket)),z=je.getCountryEntry(L),E=je.getCityEntry(L),R=je.getPalettes(L);S.useEffect((()=>{t?(r(je.getCountryErrors(L)),i(je.getCityErrors(L,w)),d(je.getLineErrors(L,w))):(v(!1),h(""),g(""),p(""),C(!1))}),[t]);const P=l.length>0||o.length>0||Object.values(c).flat().length>0,I=P&&!m,N=!I&&!b;return n.jsx(y,{classNames:{content:Oe.content,body:Oe.body},opened:t,onClose:()=>{I||N||me.storage.remove(ve),a()},title:s("Submit palettes"),children:n.jsxs(f,{active:I?0:N?1:2,classNames:{root:Oe["stepper-root"],content:Oe["stepper-content"]},children:[n.jsx(f.Step,{label:s("Validate"),color:m?"orange":void 0,completedIcon:m?n.jsx(pe,{size:24}):void 0,children:n.jsx(Ue,{countryErrors:l,cityErrors:o,lineErrors:c,onIgnore:()=>v(!0),onClose:a})}),n.jsx(f.Step,{label:s("Justify"),children:n.jsx(Me,{dataSource:u,onDataSourceChange:h,refLink:x,onRefLinkChange:g,justification:j,onJustificationChange:p,onPrev:P?()=>v(!1):void 0,onNext:()=>C(!0)})}),n.jsx(f.Step,{label:s("Submit"),children:n.jsx(Ae,{countryEntry:z,cityEntry:E,paletteList:R,dataSource:u,refLink:x,justification:j,onPrev:()=>C(!1)})})]})})}function Je(e){const{isOpen:t,onClose:a,incomingState:r}=e,{t:o}=k(),i=R();return n.jsx(y,{opened:t,onClose:a,title:o("Unsaved draft"),children:n.jsxs(s,{direction:"column",children:[n.jsx(x,{children:o("Do you want to continue with your last unsaved ticket?")}),n.jsxs(l,{gap:"xs",mt:"xs",children:[n.jsx(p,{variant:"default",ml:"auto",onClick:()=>{me.storage.remove(ve),a()},children:o("Discard")}),n.jsx(p,{onClick:()=>{r&&i(be(r)),a()},children:o("Continue")})]})]})})}}}}));
