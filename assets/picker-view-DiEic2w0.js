import{j as e,o as V,_ as N,u as W,v as G,T,G as P,B as w,$ as Y,a0 as K,a1 as J,r as R,m as X,w as Z,F as q,I as D,E as Q,p as ee,Y as te,Z as oe,k as ne,L as se}from"./mantine-DlaGph6_.js";import{l as M,r as f,o as ae}from"./react-BQLc8TMF.js";import{u as O,H as le,M as S,a as z,J as re,E as A,K as ce,N as ie}from"./index-LdIvZI_W.js";import{u as U}from"./use-translated-name-CNACQMVg.js";import{u as ue}from"./use-palette--ruc4EAe.js";import{a as de,P as pe}from"./pantone-input-CrdFWbF2.js";const Ce="_body_jalou_1",B={body:Ce,"custom-input-group":"_custom-input-group_jalou_8"},me=C=>{const t=C.toUpperCase().split("");return t.length===2?t.map(a=>((a.codePointAt(0)||0)+127397).toString(16).toUpperCase()):t.length===5?["1F3F4",...t.map(a=>((a.codePointAt(0)||0)+917536).toString(16).toUpperCase()),"E007F"]:[]},ge=C=>{const t=me(C);return String.fromCodePoint(...t.map(a=>parseInt(a,16)))};function he(C){const{defaultValueId:t,onChange:a}=C,{t:j,i18n:g}=M(),{translateName:i}=U(),{countryList:v,cityList:h}=O(o=>o.app),p=h.reduce((o,r)=>({...o,[r.id]:r}),{}),l=v.reduce((o,r)=>({...o,[r.id]:r}),{}),u=t&&t in p?t:null,x=({option:o})=>{const r=p[o.value];return r&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"flag-emoji",children:ge(le(r.country))}),e.jsx("span",{children:i(r.name)})]})},n=({options:o,search:r})=>{const c=r.toLocaleLowerCase();return o.filter(d=>{var y,E;const b=p[d.value];return b&&(b.id.toLocaleLowerCase().includes(c)||Object.values(b.name).some(L=>L.toLocaleLowerCase().includes(c))||b.country.toLocaleLowerCase().includes(c)||Object.values((E=(y=l[b.country])==null?void 0:y.name)!=null?E:{}).some(L=>L.toLocaleLowerCase().includes(c)))})},m=h.map(o=>({value:o.id,label:i(o.name)})).sort((o,r)=>o.value==="other"?1:r.value==="other"?-1:o.label.localeCompare(r.label,g.languages[0]));return e.jsx(V,{label:j("City"),data:m,value:u,onChange:o=>o&&(a==null?void 0:a(o)),renderOption:x,searchable:!0,filter:n})}function xe(C){const{city:t,defaultValueId:a,onChange:j,onSubmit:g}=C,{t:i}=M(),{translateName:v}=U(),[h,p]=f.useState(!1),l=ue(t),u=l.reduce((c,d)=>({...c,[d.id]:d}),{}),x=a&&a in u?a:null,n=c=>{if(c){const d=u[c];j==null||j(d.id,d.colour,d.fg||S.white,d.pantone)}},m=({option:c})=>{const d=u[c.value];return d&&e.jsx(N,{size:"lg",radius:"sm",color:d.colour,style:{color:d.fg||S.white},children:v(d.name)})},o=({options:c,search:d})=>{const b=d.toLocaleLowerCase();return c.filter(y=>{const E=u[y.value];return E&&(E.id.toLocaleLowerCase().includes(b)||Object.values(E.name).some(L=>L.toLocaleLowerCase().includes(b)))})},r=l.map(c=>({value:c.id,label:v(c.name)}));return e.jsx(V,{label:i("Line"),data:r,value:x,onChange:n,renderOption:m,searchable:!0,filter:o,onDropdownOpen:()=>p(!0),onDropdownClose:()=>p(!1),onKeyDown:({key:c})=>!h&&c==="Enter"&&(g==null?void 0:g()),disabled:!t})}function je({onApply:C}){const{t}=M(),a=z(),{recentlyUsed:j}=O(l=>l.app),[g,i]=f.useState(!1),v=t(g?"Remove":"Apply"),h=l=>{a(re(l)),R.event(A.REMOVE_HISTORY_ITEM,{})},p=()=>{a(ce()),R.event(A.CLEAR_HISTORY,{})};return e.jsxs(W,{w:"100%",children:[e.jsxs(G,{children:[e.jsx(T,{order:2,size:"h4",children:t("Recently used")}),e.jsx(P,{gap:"xs",ml:"auto",children:g?e.jsxs(e.Fragment,{children:[e.jsx(w,{variant:"default",size:"xs",onClick:p,children:t("Clear all")}),e.jsx(w,{size:"xs",onClick:()=>i(!1),children:t("Done")})]}):e.jsx(w,{variant:"default",size:"xs",onClick:()=>i(!0),children:t("Clear")})})]}),e.jsx(Y,{children:e.jsx(P,{gap:"xs",p:"xs",children:j.map(({theme:l,displayName:u},x)=>e.jsx(K,{bg:l[2],fg:l[3],"aria-label":v+" "+u,title:v+" "+u,onClick:()=>g?h(x):C(l),children:g?e.jsx(J,{}):"Aa"},l.join("-")))})})]})}const fe=C=>!!C.match(/^#[0-9a-fA-F]{6}$/);function ve(C){const{defaultTheme:t,sessionId:a,onSubmit:j,onClose:g}=C,{t:i}=M(),{pantoneReady:v}=O(s=>s.app),[h,p]=f.useState(t==null?void 0:t[0]),[l,u]=f.useState(t==null?void 0:t[1]),[x,n]=f.useState((t==null?void 0:t[2])||"#AAAAAA"),[m,o]=f.useState((t==null?void 0:t[3])||S.white),[r,c]=f.useState(""),[d,b]=f.useState("rgb"),y=()=>{c(""),b(s=>s==="pantone"?"rgb":s)};f.useEffect(()=>{a&&t&&(p(t[0]),u(t[1]),n(t[2]),o(t[3]),y())},[a,t==null?void 0:t.toString()]);const E=[{label:i("RGB"),value:"rgb"},{label:i("PantoneÂ®"),value:"pantone",disabled:!v}],L=[{label:i("Black"),value:S.black},{label:i("White"),value:S.white}],_=h&&l&&x&&m&&fe(x),k=()=>{if(_){const s="".concat(h," - ").concat(l),I=x.toLowerCase();j==null||j([h,l,I,m],s)}},$=s=>{p(s[0]),u(s[1]),n(s[2]),o(s[3]),y()};return e.jsxs(e.Fragment,{children:[e.jsx(X,{children:e.jsxs(Z,{className:B.body,children:[e.jsx(q,{children:e.jsx(N,{size:"xl",radius:"sm",color:x,style:{color:m},children:i("Example")})}),e.jsxs(P,{w:"100%",grow:!0,children:[e.jsx(he,{defaultValueId:h,onChange:s=>{p(s),u(void 0),n("#AAAAAA"),o(S.white)}}),e.jsx(xe,{city:h,defaultValueId:l,onChange:(s,I,H,F)=>{u(s),n(I),o(H),F&&c(F)},onSubmit:k})]}),e.jsx(de,{display:"none"}),e.jsxs(P,{w:"100%",className:B["custom-input-group"],children:[e.jsx(D,{size:"sm",label:i("Input mode"),data:E,value:d,onChange:s=>b(s)}),d==="pantone"&&e.jsx(pe,{value:r,onChange:(s,I)=>{p("other"),u("other"),n(I),c(s)}}),d!=="pantone"&&(window.EyeDropper?e.jsx(Q,{label:i("Background colour"),value:x,onChange:s=>{p("other"),u("other"),n(s),y()}}):e.jsx(ee,{type:"color",label:i("Background colour"),value:x,onChange:({currentTarget:{value:s}})=>{p("other"),u("other"),n(s),y()}})),e.jsx(D,{size:"sm",label:i("Foreground colour"),data:L,value:m,onChange:s=>{p("other"),u("other"),o(s)}})]}),e.jsx(je,{onApply:$})]})}),e.jsx(te,{}),e.jsx(oe,{children:e.jsxs(P,{ml:"auto",gap:"sm",children:[e.jsx(w,{variant:"default",size:"sm",onClick:g,children:i("Cancel")}),e.jsx(w,{variant:"filled",size:"sm",onClick:k,disabled:!_,children:i("Confirm")})]})})]})}const be="rmg-palette-bridge--";function we(){const[C]=ae(),t=C.get("parentId"),a=C.get("parentComponent"),j=z(),{isDataLoading:g}=O(n=>n.app),[i,v]=f.useState(),[h,p]=f.useState(),l=f.useRef(null);f.useEffect(()=>{const n=new BroadcastChannel(be+t);return l.current=n,R.event(A.APP_CLIP_VIEW_OPENED,{parentComponent:a}),n.onmessage=m=>{const{event:o,data:r}=m.data;console.log("[".concat(n.name,"] Received event from parent component:"),o),o==="OPEN"&&(v(crypto.randomUUID()),p(r))},console.log("[".concat(n.name,"] App clip connection established, parentComponent=").concat(a)),n.postMessage({event:"LOADED"}),()=>{n.close()}},[]);const u=(n,m)=>{var o,r;console.log("[".concat((o=l.current)==null?void 0:o.name,"] Emitting SELECT event, theme:"),n),(r=l.current)==null||r.postMessage({event:"SELECT",data:n}),j(ie({theme:n,displayName:m})),R.event(A.APP_CLIP_VIEW_SELECT,{parentComponent:a,theme:n})},x=()=>{var n,m;console.log("[".concat((n=l.current)==null?void 0:n.name,"] Emitting CLOSE event")),(m=l.current)==null||m.postMessage({event:"CLOSE"}),R.event(A.APP_CLIP_VIEW_CLOSED,{parentComponent:a})};return e.jsxs(ne,{children:[e.jsx(se,{visible:g}),e.jsx(ve,{defaultTheme:h,sessionId:i,onSubmit:u,onClose:x})]})}export{we as default};
