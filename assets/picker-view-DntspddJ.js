import{j as e,o as V,a0 as N,u as H,v as W,T as G,G as P,B as I,a1 as K,a2 as Y,a3 as J,r as w,m as X,w as q,F as Q,H as D,_ as Z,$ as ee,k as te,L as ne}from"./mantine-D7LdMwm-.js";import{l as A,r as g,o as oe}from"./react-CZSUUdJN.js";import{u as M,H as se,M as L,a as T,J as ae,E as R,K as le,N as re}from"./index-CNit2NAI.js";import{u as z}from"./use-translated-name-QJePg0J0.js";import{u as ce}from"./use-palette-DgPbHJWy.js";import{a as ie,P as ue,C as de}from"./compatible-colour-input-COXScFRT.js";const pe="_body_jalou_1",B={body:pe,"custom-input-group":"_custom-input-group_jalou_8"},me=m=>{const t=m.toUpperCase().split("");return t.length===2?t.map(l=>((l.codePointAt(0)||0)+127397).toString(16).toUpperCase()):t.length===5?["1F3F4",...t.map(l=>((l.codePointAt(0)||0)+917536).toString(16).toUpperCase()),"E007F"]:[]},Ce=m=>{const t=me(m);return String.fromCodePoint(...t.map(l=>parseInt(l,16)))};function he(m){const{defaultValueId:t,onChange:l}=m,{t:v,i18n:f}=A(),{translateName:c}=z(),{countryList:x,cityList:C}=M(n=>n.app),p=C.reduce((n,i)=>({...n,[i.id]:i}),{}),o=x.reduce((n,i)=>({...n,[i.id]:i}),{}),d=t&&t in p?t:null,h=({option:n})=>{const i=p[n.value];return i&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"flag-emoji",children:Ce(se(i.country))}),e.jsx("span",{children:c(i.name)})]})},s=({options:n,search:i})=>{const r=i.toLocaleLowerCase();return n.filter(u=>{const b=p[u.value];return b&&(b.id.toLocaleLowerCase().includes(r)||Object.values(b.name).some(y=>y.toLocaleLowerCase().includes(r))||b.country.toLocaleLowerCase().includes(r)||Object.values(o[b.country]?.name??{}).some(y=>y.toLocaleLowerCase().includes(r)))})},j=C.map(n=>({value:n.id,label:c(n.name)})).sort((n,i)=>n.value==="other"?1:i.value==="other"?-1:n.label.localeCompare(i.label,f.languages[0]));return e.jsx(V,{label:v("City"),data:j,value:d,onChange:n=>n&&l?.(n),renderOption:h,searchable:!0,filter:s})}function ge(m){const{city:t,defaultValueId:l,onChange:v,onSubmit:f}=m,{t:c}=A(),{translateName:x}=z(),[C,p]=g.useState(!1),o=ce(t),d=o.reduce((r,u)=>({...r,[u.id]:u}),{}),h=l&&l in d?l:null,s=r=>{if(r){const u=d[r];v?.(u.id,u.colour,u.fg||L.white,u.pantone)}},j=({option:r})=>{const u=d[r.value];return u&&e.jsx(N,{size:"lg",radius:"sm",color:u.colour,style:{color:u.fg||L.white},children:x(u.name)})},n=({options:r,search:u})=>{const b=u.toLocaleLowerCase();return r.filter(y=>{const S=d[y.value];return S&&(S.id.toLocaleLowerCase().includes(b)||Object.values(S.name).some(O=>O.toLocaleLowerCase().includes(b)))})},i=o.map(r=>({value:r.id,label:x(r.name)}));return e.jsx(V,{label:c("Line"),data:i,value:h,onChange:s,renderOption:j,searchable:!0,filter:n,onDropdownOpen:()=>p(!0),onDropdownClose:()=>p(!1),onKeyDown:({key:r})=>!C&&r==="Enter"&&f?.(),disabled:!t})}function fe({onApply:m}){const{t}=A(),l=T(),{recentlyUsed:v}=M(o=>o.app),[f,c]=g.useState(!1),x=t(f?"Remove":"Apply"),C=o=>{l(ae(o)),w.event(R.REMOVE_HISTORY_ITEM,{})},p=()=>{l(le()),w.event(R.CLEAR_HISTORY,{})};return e.jsxs(H,{w:"100%",children:[e.jsxs(W,{children:[e.jsx(G,{order:2,size:"h4",children:t("Recently used")}),e.jsx(P,{gap:"xs",ml:"auto",children:f?e.jsxs(e.Fragment,{children:[e.jsx(I,{variant:"default",size:"xs",onClick:p,children:t("Clear all")}),e.jsx(I,{size:"xs",onClick:()=>c(!1),children:t("Done")})]}):e.jsx(I,{variant:"default",size:"xs",onClick:()=>c(!0),children:t("Clear")})})]}),e.jsx(K,{children:e.jsx(P,{gap:"xs",p:"xs",children:v.map(({theme:o,displayName:d},h)=>e.jsx(Y,{bg:o[2],fg:o[3],"aria-label":x+" "+d,title:x+" "+d,onClick:()=>f?C(h):m(o),children:f?e.jsx(J,{}):"Aa"},o.join("-")))})})]})}const je=m=>!!m.match(/^#[0-9a-fA-F]{6}$/);function xe(m){const{defaultTheme:t,sessionId:l,onSubmit:v,onClose:f}=m,{t:c}=A(),{pantoneReady:x}=M(a=>a.app),[C,p]=g.useState(t?.[0]),[o,d]=g.useState(t?.[1]),[h,s]=g.useState(t?.[2]||"#AAAAAA"),[j,n]=g.useState(t?.[3]||L.white),[i,r]=g.useState(""),[u,b]=g.useState("rgb"),y=()=>{r(""),b(a=>a==="pantone"?"rgb":a)};g.useEffect(()=>{l&&t&&(p(t[0]),d(t[1]),s(t[2]),n(t[3]),y())},[l,t?.toString()]);const S=[{label:c("RGB"),value:"rgb"},{label:c("PantoneÂ®"),value:"pantone",disabled:!x}],O=[{label:c("Black"),value:L.black},{label:c("White"),value:L.white}],_=C&&o&&h&&j&&je(h),F=()=>{if(_){const a=`${C} - ${o}`,E=h.toLowerCase();v?.([C,o,E,j],a)}},U=a=>{p(a[0]),d(a[1]),s(a[2]),n(a[3]),y()};return e.jsxs(e.Fragment,{children:[e.jsx(X,{children:e.jsxs(q,{className:B.body,children:[e.jsx(Q,{children:e.jsx(N,{size:"xl",radius:"sm",color:h,style:{color:j},children:c("Example")})}),e.jsxs(P,{w:"100%",grow:!0,children:[e.jsx(he,{defaultValueId:C,onChange:a=>{p(a),d(void 0),s("#AAAAAA"),n(L.white)}}),e.jsx(ge,{city:C,defaultValueId:o,onChange:(a,E,$,k)=>{d(a),s(E),n($),k&&r(k)},onSubmit:F})]}),e.jsx(ie,{display:"none"}),e.jsxs(P,{w:"100%",className:B["custom-input-group"],children:[e.jsx(D,{size:"sm",label:c("Input mode"),data:S,value:u,onChange:a=>b(a)}),u==="pantone"&&e.jsx(ue,{value:i,onChange:(a,E)=>{p("other"),d("other"),s(E),r(a)}}),u!=="pantone"&&e.jsx(de,{label:c("Background colour"),value:h,onChange:a=>{p("other"),d("other"),s(a),y()}}),e.jsx(D,{size:"sm",label:c("Foreground colour"),data:O,value:j,onChange:a=>{p("other"),d("other"),n(a)}})]}),e.jsx(fe,{onApply:U})]})}),e.jsx(Z,{}),e.jsx(ee,{children:e.jsxs(P,{ml:"auto",gap:"sm",children:[e.jsx(I,{variant:"default",size:"sm",onClick:f,children:c("Cancel")}),e.jsx(I,{variant:"filled",size:"sm",onClick:F,disabled:!_,children:c("Confirm")})]})})]})}const be="rmg-palette-bridge--";function Ie(){const[m]=oe(),t=m.get("parentId"),l=m.get("parentComponent"),v=T(),{isDataLoading:f}=M(s=>s.app),[c,x]=g.useState(),[C,p]=g.useState(),o=g.useRef(null);g.useEffect(()=>{const s=new BroadcastChannel(be+t);return o.current=s,w.event(R.APP_CLIP_VIEW_OPENED,{parentComponent:l}),s.onmessage=j=>{const{event:n,data:i}=j.data;console.log(`[${s.name}] Received event from parent component:`,n),n==="OPEN"&&(x(crypto.randomUUID()),p(i))},console.log(`[${s.name}] App clip connection established, parentComponent=${l}`),s.postMessage({event:"LOADED"}),()=>{s.close()}},[]);const d=(s,j)=>{console.log(`[${o.current?.name}] Emitting SELECT event, theme:`,s),o.current?.postMessage({event:"SELECT",data:s}),v(re({theme:s,displayName:j})),w.event(R.APP_CLIP_VIEW_SELECT,{parentComponent:l,theme:s})},h=()=>{console.log(`[${o.current?.name}] Emitting CLOSE event`),o.current?.postMessage({event:"CLOSE"}),w.event(R.APP_CLIP_VIEW_CLOSED,{parentComponent:l})};return e.jsxs(te,{children:[e.jsx(ne,{visible:f}),e.jsx(xe,{defaultTheme:C,sessionId:c,onSubmit:d,onClose:h})]})}export{Ie as default};
