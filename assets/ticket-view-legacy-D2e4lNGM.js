System.register(["./mantine-legacy-Bk4Jn8Fz.js","./react-legacy-3C4zREH5.js","./index-legacy-DJfpzrTG.js","./use-translated-name-legacy-DAwon0wS.js","./pantone-input-legacy-BspdnXnw.js","./palette-card.module-legacy-DZJ4IRnh.js"],(function(e,t){"use strict";var n,a,s,l,r,o,i,c,d,u,h,x,g,p,j,m,b,v,y,f,C,w,k,S,L,E,_,z,R,N,P,I,O,T,U,D,M,A,F,B,J,$,V,q,G,K,Y,Z,H,W,Q,X,ee,te,ne,ae,se,le,re,oe,ie,ce,de,ue,he,xe,ge,pe,je,me,be,ve,ye,fe,Ce,we,ke,Se,Le,Ee,_e,ze,Re;return{setters:[e=>{n=e.j,a=e.n,s=e.F,l=e.G,r=e.o,o=e.p,i=e.i,c=e.q,d=e.s,u=e.t,h=e.u,x=e.v,g=e.T,p=e.w,j=e.N,m=e.x,b=e.C,v=e.f,y=e.y,f=e.z,C=e.M,w=e.D,k=e.E,S=e.H,L=e.I,E=e.B,_=e.J,z=e.K,R=e.O,N=e.P,P=e.Q,I=e.U,O=e.V,T=e.W,U=e.X,D=e.r,M=e.l,A=e.k,F=e.L,B=e.m,J=e.Y,$=e.Z},e=>{V=e.l,q=e.r},e=>{G=e.L,K=e.a,Y=e.u,Z=e.b,H=e.c,W=e.d,Q=e.r,X=e.e,ee=e.f,te=e.g,ne=e.h,ae=e.i,se=e.j,le=e.k,re=e.l,oe=e.p,ie=e.m,ce=e.M,de=e.n,ue=e.o,he=e.q,xe=e.t,ge=e.v,pe=e.w,je=e.x,me=e.y,be=e.z,ve=e.I,ye=e.D,fe=e.G,Ce=e.A,we=e.B,ke=e.C,Se=e.F,Le=e.E},e=>{Ee=e.u},e=>{_e=e.P,ze=e.a},e=>{Re=e.c}],execute:function(){var t=document.createElement("style");t.textContent="._row_1uk92_1{flex-wrap:wrap;align-items:flex-start}._row_1uk92_1>*{flex:1;min-width:calc(8.125rem * var(--mantine-scale))}._content_euz2o_1,._body_euz2o_7,._stepper-root_euz2o_14,._stepper-content_euz2o_21{display:flex;flex-direction:column;overflow:hidden}._step-body_euz2o_28{overflow-y:auto}\n/*$vite$:1*/",document.head.appendChild(t),e("default",(function(){const{t:e}=V(),t=K(),{isDataLoading:a}=Y((e=>e.app)),[s,r]=q.useState(),[o,i]=q.useState(!1),[c,d]=q.useState(!1);return q.useEffect((()=>{const e=D.storage.get(ke);if(e)try{const t=JSON.parse(e);Object.keys(t.lines).length>0&&Object.values(t.lines)[0].id&&(r(t),i(!0))}catch{M.error("<TicketView/>, unable to restore draft ticket",e)}}),[]),n.jsxs(A,{w:{base:"100%",sm:600},style:{alignSelf:"center"},children:[n.jsx(F,{visible:a}),n.jsxs(B,{direction:"column",px:"xs",style:{overflowY:"auto"},children:[n.jsx(Oe,{}),n.jsx(Te,{}),n.jsx(De,{})]}),n.jsx(J,{}),n.jsx($,{children:n.jsxs(l,{flex:1,gap:"sm",children:[n.jsx(E,{variant:"default",onClick:()=>{D.openApp({appId:"rmg-palette"})},children:e("Go back")}),n.jsx(E,{variant:"default",ml:"auto",onClick:()=>{t(Se()),D.storage.remove(ke),D.event(Le.RESET_TICKET,{})},children:e("Reset")}),n.jsx(E,{onClick:()=>d(!0),children:e("Submit")})]})}),n.jsx(Ve,{isOpen:o,onClose:()=>i(!1),incomingState:s}),n.jsx($e,{isOpen:c,onClose:()=>d(!1)})]})}));const Ne={row:"_row_1uk92_1"},Pe=e=>{const{onUpdate:t,onLangSwitch:h,onRemove:x}=e,g=e.entries??[],{t:p}=V(),{translateName:j}=Ee(),m=Object.entries(G).map((([e,t])=>({value:e,label:j(t),disabled:g.some((t=>t[0]===e))}))),b=()=>{const e=Object.keys(G).filter((e=>!g.find((t=>t[0]===e))))[0];t(e,"")};return n.jsx(a,{legend:p("Multi-languages"),children:g.map((([e,a],g,j)=>n.jsxs(s,{pt:4,align:"center","data-testid":"entry-card-stack-"+e,children:[n.jsxs(l,{gap:"xs",flex:1,grow:!0,children:[n.jsx(r,{size:"xs","aria-label":p("Language"),value:e,onChange:t=>h(e,t),data:m,searchable:!0}),n.jsx(o,{size:"xs","aria-label":p("Name"),placeholder:p("Enter name"),value:a,onChange:({currentTarget:{value:n}})=>t(e,n)})]}),n.jsxs(s,{ml:8,wrap:"nowrap",children:[g===j.length-1?n.jsx(i,{size:"sm",variant:"filled","aria-label":p("Add a name in another language"),title:p("Add a name in another language"),onClick:b,children:n.jsx(c,{})}):n.jsx(d,{w:22}),j.length>1&&n.jsx(i,{size:"sm",variant:"outline","aria-label":p("Remove this name"),title:p("Remove this name"),onClick:()=>x(e),ml:4,children:n.jsx(u,{})})]})]},g)))})};function Ie(e){return n.jsx(Pe,{...e})}function Oe(){const{t:e,i18n:t}=V(),{translateName:a}=Ee(),s=K(),{countryList:r}=Y((e=>e.app)),{country:i,newCountry:c,countryName:d,newCountryLangs:u}=Y((e=>e.ticket));q.useEffect((()=>{if(i&&"new"!==i){const e=r.find((e=>e.id===i));e&&(s(Z(i)),s(H(e.languages)))}}),[i]);const b=[{value:"",label:e("Please select..."),disabled:!0},...r.filter((e=>"UN"!==e.id)).map((e=>({value:e.id,label:a(e.name)}))).toSorted(((e,n)=>e.label.localeCompare(n.label,t.languages[0]))),{value:"new",label:e("Add a country/region...")}],v=Object.entries(G).map((([e,t])=>({value:e,label:a(t)})));return n.jsxs(h,{children:[n.jsx(x,{children:n.jsx(g,{order:2,size:"h4",children:e("Country/Region")})}),n.jsxs(p,{py:4,gap:"xs",children:[n.jsxs(l,{className:Ne.row,children:[n.jsx(j,{label:e("Country/Region"),value:i,onChange:({currentTarget:{value:e}})=>s(W(e)),data:b}),n.jsx(o,{label:e("Country/region code"),placeholder:"e.g. CN, HK, JP (ISO 3166-1 alpha-2)",value:c,onChange:({currentTarget:{value:e}})=>s(Z(e)),error:c&&!c.match(/^[A-Z]{2}$|^GB[A-Z]{3}$/)?e("Country code should be in the format of ISO 3166-1 alpha-2"):void 0,disabled:"new"!==i}),n.jsx(m,{label:e("Official language"),value:u,onChange:e=>s(H(e)),data:v,searchable:!0,disabled:"new"!==i})]}),"new"===i&&n.jsx(Ie,{entries:d,onUpdate:(e,t)=>s(ee({lang:e,name:t})),onLangSwitch:(e,t)=>s(X({prevLang:e,nextLang:t})),onRemove:e=>s(Q(e))})]})]})}function Te(){const{t:e,i18n:t}=V(),a=K(),{translateName:s}=Ee(),{cityList:r}=Y((e=>e.app)),{country:i,city:c,newCity:d,cityName:u}=Y((e=>e.ticket)),m=[{value:"",label:e("Please select..."),disabled:!0},...r.filter((e=>e.country===i)).map((e=>({value:e.id,label:s(e.name)}))).toSorted(((e,n)=>e.label.localeCompare(n.label,t.languages[0]))),{value:"new",label:e("Add a city")+"..."}];return n.jsxs(h,{children:[n.jsx(x,{children:n.jsx(g,{order:2,size:"h4",children:e("City")})}),n.jsxs(p,{py:4,gap:"xs",children:[n.jsxs(l,{align:"flex-start",grow:!0,children:[n.jsx(j,{label:e("City"),value:c,onChange:({currentTarget:{value:e}})=>(async e=>{if("new"===e)return void a(le("new"));const t=await re(e,r);a(t?oe(t):ie())})(e),data:m}),"new"===c&&n.jsx(o,{label:e("City code"),placeholder:"e.g. hongkong, guangzhou, shanghai",value:d,onChange:({currentTarget:{value:e}})=>a(te(e)),error:d&&d.match(/[^a-z]/)?"City code should contain lower case letters only":void 0})]}),"new"===c&&n.jsx(Ie,{entries:u,onUpdate:(e,t)=>a(se({lang:e,name:t})),onLangSwitch:(e,t)=>a(ae({prevLang:e,nextLang:t})),onRemove:e=>a(ne(e))})]})]})}function Ue({lineDetail:e,onUpdate:t,onMoveUp:a,onMoveDown:s,onCopy:r,onRemove:c,onNameUpdate:d,onNameRemove:h,onLangSwitch:x}){const{t:g}=V(),{translateName:j}=Ee(),{pantoneReady:m}=Y((e=>e.app)),[E,_]=q.useState(!!e.pantone),[z,R]=q.useState(!1),N=q.useRef(null),P=[{label:g("Black"),value:ce.black},{label:g("White"),value:ce.white}],I=e.fg===ce.black?"black":"white";return n.jsxs(b,{ref:N,className:Re.editable,withBorder:!0,children:[n.jsxs(b.Section,{bg:e.colour,className:Re["card-section"],children:[n.jsx(v,{span:!0,style:{color:I},children:j(Object.fromEntries(e.nameEntity))}),n.jsxs(l,{gap:"xs",ml:"auto",children:[n.jsx(i,{size:"xs",variant:"subtle",color:I,"aria-label":g("Move up"),title:g("Move up"),onClick:a,children:n.jsx(y,{})}),n.jsx(i,{size:"xs",variant:"subtle",color:I,"aria-label":g("Move down"),title:g("Move down"),onClick:s,children:n.jsx(f,{})}),n.jsx(i,{size:"xs",variant:"subtle",color:I,"aria-label":g("Edit"),title:g("Edit"),onClick:()=>{z?R(!1):(R(!0),setTimeout((()=>{N.current?.scrollIntoView({behavior:"smooth"})}),0))},children:n.jsx(C,{})}),n.jsx(i,{size:"xs",variant:"subtle",color:I,"aria-label":g("Duplicate"),title:g("Duplicate"),onClick:r,children:n.jsx(w,{})}),n.jsx(i,{size:"xs",variant:"subtle",color:I,"aria-label":g("Remove"),title:g("Remove"),onClick:c,children:n.jsx(u,{})})]})]}),z&&n.jsxs(p,{gap:"xs",mt:"xs",children:[n.jsxs(l,{gap:"xs",className:Re["editable-group"],children:[n.jsx(o,{label:g("Line code"),placeholder:"e.g. twl, gz1, sh1",value:e.id,onChange:({currentTarget:{value:e}})=>t?.({id:e}),error:e.id?.match(/[^a-z0-9]/)?g("Line code should be alphanumeric"):void 0}),window.EyeDropper?n.jsx(k,{label:g("Background colour"),value:e.colour,onChange:e=>t?.({colour:e}),disabled:m&&E}):n.jsx(o,{type:"color",label:g("Background colour"),value:e.colour,onChange:({currentTarget:{value:e}})=>t?.({colour:e}),disabled:m&&E}),m&&n.jsx(S,{label:g("Use PantoneÂ®"),checked:E,onChange:({currentTarget:{checked:e}})=>_(e),mt:"xl"}),m&&E&&n.jsx(_e,{value:e.pantone??"",onChange:(e,n)=>t?.({pantone:e,colour:n})}),n.jsx(L,{size:"sm",label:g("Foreground colour"),data:P,value:e.fg,onChange:e=>t?.({fg:e})})]}),n.jsx(Ie,{entries:e.nameEntity,onUpdate:(e,t)=>d?.(e,t),onLangSwitch:(e,t)=>x?.(e,t),onRemove:e=>h?.(e)})]})]})}function De(){const{t:e}=V(),t=K(),a=Y((e=>e.ticket.lines)),s=q.useRef(null),l=q.useCallback((()=>{setTimeout((()=>{s.current?.lastElementChild?.scrollIntoView({behavior:"smooth"})}),0)}),[s.current]);return n.jsxs(h,{children:[n.jsxs(x,{children:[n.jsx(g,{order:2,size:"h4",children:e("Lines")}),n.jsx(ze,{ml:"auto"})]}),n.jsxs(p,{ref:s,py:4,gap:"xs",children:[Object.entries(a).map((([e,a])=>n.jsx(Ue,{lineDetail:a,onUpdate:n=>t(je({entryId:e,updates:n})),onMoveUp:()=>t(pe(e)),onMoveDown:()=>t(ge(e)),onCopy:()=>(e=>{t(me(e)),l()})(e),onRemove:()=>t(xe(e)),onNameUpdate:(n,a)=>t(he({entryId:e,lang:n,name:a})),onLangSwitch:(n,a)=>t(ue({entryId:e,prevLang:n,nextLang:a})),onNameRemove:n=>t(de({entryId:e,lang:n}))},e))),n.jsx(E,{size:"xs",variant:"outline",leftSection:n.jsx(c,{}),ml:"auto",onClick:()=>{t(be()),l()},children:e("Add a line")})]})]})}const Me={content:"_content_euz2o_1",body:"_body_euz2o_7","stepper-root":"_stepper-root_euz2o_14","stepper-content":"_stepper-content_euz2o_21","step-body":"_step-body_euz2o_28"};function Ae(e){const{countryErrors:t,cityErrors:a,lineErrors:s,onIgnore:r,onClose:o}=e,{t:i}=V(),{translateName:c}=Ee();return n.jsxs(n.Fragment,{children:[n.jsxs(p,{gap:"xs",className:Me["step-body"],children:[n.jsx(v,{children:i("Your inputs contain the following errors. Please consider fixing it before submitting.")}),t.length>0&&n.jsxs(n.Fragment,{children:[n.jsx(g,{order:3,size:"h5",children:i("Country/Region")}),n.jsx(_,{size:"sm",withPadding:!0,"aria-label":"List of country errors",children:t.map(((e,t)=>n.jsx(_.Item,{children:c(ve[e])},t)))})]}),a.length>0&&n.jsxs(n.Fragment,{children:[n.jsx(g,{order:3,size:"h5",children:i("City")}),n.jsx(_,{size:"sm",withPadding:!0,"aria-label":"List of city errors",children:a.map(((e,t)=>n.jsx(_.Item,{children:c(ve[e])},t)))})]}),Object.values(s).flat().length>0&&n.jsxs(n.Fragment,{children:[n.jsx(g,{order:3,size:"h5",children:i("Lines")}),n.jsx(_,{size:"sm",withPadding:!0,"aria-label":"List of line errors",children:Object.entries(s).map((([e,t])=>n.jsxs(_.Item,{children:[e,n.jsx(_,{size:"sm",withPadding:!0,children:t.map(((e,t)=>n.jsx(_.Item,{children:c(ve[e])},t)))})]},e)))})]})]}),n.jsxs(l,{gap:"sm",pt:"xs",children:[n.jsx(E,{variant:"default",ml:"auto",onClick:o,children:i("Go back")}),n.jsx(E,{onClick:r,children:i("Submit anyway")})]})]})}const Fe=e=>!!e.match(/^https?:\/\//)?.[0];function Be(e){const{dataSource:t,onDataSourceChange:a,refLink:s,onRefLinkChange:r,justification:i,onJustificationChange:c,onPrev:d,onNext:u}=e,{t:h}=V(),{translateName:x}=Ee(),g=[{value:"",label:h("Please select..."),disabled:!0},...Object.entries(ye).map((([e,t])=>({value:e,label:x(t)})))],m=!(t&&s&&i&&Fe(s));return n.jsxs(n.Fragment,{children:[n.jsxs(p,{gap:"xs",className:Me["step-body"],children:[n.jsx(v,{children:h("Please provide suitable source and justification.")}),n.jsx(j,{label:h("Data source"),value:t,onChange:({currentTarget:{value:e}})=>a(e),data:g}),n.jsx(o,{label:h("Reference link"),placeholder:h("Enter a valid URL, e.g.")+" https://en.wikipedia.org",value:s,onChange:({currentTarget:{value:e}})=>r(e),error:s&&!Fe(s)?h("URL is invalid"):void 0}),n.jsx(z,{label:h("Justification"),placeholder:h("Briefly describe your changes and provide justification"),value:i,onChange:({currentTarget:{value:e}})=>c(e),autosize:!0,minRows:3})]}),n.jsxs(l,{gap:"sm",pt:"xs",children:[d&&n.jsx(E,{variant:"default",onClick:d,leftSection:n.jsx(R,{}),children:h("Previous")}),n.jsx(E,{ml:"auto",onClick:u,rightSection:n.jsx(N,{}),disabled:m,children:h("Next")})]})]})}function Je(e){const{countryEntry:t,cityEntry:a,paletteList:s,dataSource:r,refLink:o,justification:i,onPrev:c}=e,{t:d}=V(),{translateName:u}=Ee(),h=q.useRef(null),x=[`**Data source:** ${r?u(ye[r]):"(REPLACE ME)"}`,`**Reference link:** ${o||"(REPLACE ME)"}`,`**Justification:** ${i||"(REPLACE ME)"}`,fe,Ce("country",t),Ce("city",a),Ce("lines",s)].join("\n\n"),g=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+a?.name?.en,body:x}),j=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+a?.name?.en});return n.jsxs(n.Fragment,{children:[n.jsxs(p,{gap:"xs",className:Me["step-body"],children:[n.jsx(v,{children:d("If the button below doesn't work for you, please follow the instructions below:")}),n.jsxs(_,{type:"ordered",withPadding:!0,children:[n.jsxs(_.Item,{children:[d("Open")," ",n.jsxs(P,{href:"https://github.com/railmapgen/rmg-palette/issues/new?"+j.toString(),target:"_blank",children:["Issue: New Palettes Request ",n.jsx(I,{})]})]}),n.jsxs(_.Item,{children:[d("Paste following text to the issue body")," ",n.jsx(E,{size:"xs",variant:"light",leftSection:n.jsx(w,{}),onClick:async()=>{h?.current&&(h.current.select(),await navigator.clipboard.writeText(x))},children:d("Copy")}),n.jsx(z,{ref:h,readOnly:!0,defaultValue:x,onClick:({target:e})=>e.select(),mt:"xs",autosize:!0,maxRows:3})]})]})]}),n.jsxs(l,{gap:"sm",pt:"xs",children:[n.jsx(E,{variant:"default",onClick:c,leftSection:n.jsx(R,{}),children:d("Previous")}),n.jsx(E,{ml:"auto",onClick:()=>window.open("https://github.com/railmapgen/rmg-palette/issues/new?"+g.toString(),"_blank"),children:d("1-click open issue")})]})]})}function $e(e){const{isOpen:t,onClose:a}=e,{t:s}=V(),[l,r]=q.useState([]),[o,i]=q.useState([]),[c,d]=q.useState({}),[u,h]=q.useState(""),[x,g]=q.useState(""),[p,j]=q.useState(""),[m,b]=q.useState(!1),[v,y]=q.useState(!1),{countryList:f}=Y((e=>e.app)),C=Y((e=>e.ticket)),w=we.getCountryEntry(C),k=we.getCityEntry(C),S=we.getPalettes(C);q.useEffect((()=>{t?(r(we.getCountryErrors(C)),i(we.getCityErrors(C,f)),d(we.getLineErrors(C,f))):(b(!1),h(""),g(""),j(""),y(!1))}),[t]);const L=l.length>0||o.length>0||Object.values(c).flat().length>0,E=L&&!m,_=!E&&!v;return n.jsx(O,{classNames:{content:Me.content,body:Me.body},opened:t,onClose:()=>{E||_||D.storage.remove(ke),a()},title:s("Submit palettes"),children:n.jsxs(T,{active:E?0:_?1:2,classNames:{root:Me["stepper-root"],content:Me["stepper-content"]},children:[n.jsx(T.Step,{label:s("Validate"),color:m?"orange":void 0,completedIcon:m?n.jsx(U,{size:24}):void 0,children:n.jsx(Ae,{countryErrors:l,cityErrors:o,lineErrors:c,onIgnore:()=>b(!0),onClose:a})}),n.jsx(T.Step,{label:s("Justify"),children:n.jsx(Be,{dataSource:u,onDataSourceChange:h,refLink:x,onRefLinkChange:g,justification:p,onJustificationChange:j,onPrev:L?()=>b(!1):void 0,onNext:()=>y(!0)})}),n.jsx(T.Step,{label:s("Submit"),children:n.jsx(Je,{countryEntry:w,cityEntry:k,paletteList:S,dataSource:u,refLink:x,justification:p,onPrev:()=>y(!1)})})]})})}function Ve(e){const{isOpen:t,onClose:a,incomingState:r}=e,{t:o}=V(),i=K();return n.jsx(O,{opened:t,onClose:a,title:o("Unsaved draft"),children:n.jsxs(s,{direction:"column",children:[n.jsx(v,{children:o("Do you want to continue with your last unsaved ticket?")}),n.jsxs(l,{gap:"xs",mt:"xs",children:[n.jsx(E,{variant:"default",ml:"auto",onClick:()=>{D.storage.remove(ke),a()},children:o("Discard")}),n.jsx(E,{onClick:()=>{r&&i(Se(r)),a()},children:o("Continue")})]})]})})}}}}));
