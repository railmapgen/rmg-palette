System.register(["./mantine-legacy-BZPyqDFn.js","./react-legacy-Bkm4g_oU.js","./index-legacy-DTvTksAT.js","./use-translated-name-legacy-BZLNJKPV.js","./pantone-input-legacy-C1Kl2K3j.js","./palette-card.module-legacy-C_mIYdI3.js"],(function(e,t){"use strict";var n,a,s,l,r,o,i,c,d,u,h,x,g,p,j,m,b,v,f,y,C,w,k,S,L,_,z,E,R,P,N,I,O,T,U,D,M,A,F,J,$,B,V,q,G,K,Y,Z,H,W,Q,X,ee,te,ne,ae,se,le,re,oe,ie,ce,de,ue,he,xe,ge,pe,je,me,be,ve,fe,ye,Ce,we,ke,Se,Le,_e,ze,Ee,Re;return{setters:[e=>{n=e.j,a=e.o,s=e.F,l=e.G,r=e.p,o=e.q,i=e.n,c=e.r,d=e.g,u=e.e,h=e.N,x=e.s,g=e.h,p=e.T,j=e.t,m=e.v,b=e.f,v=e.w,f=e.x,y=e.b,C=e.d,w=e.y,k=e.L,S=e.D},e=>{L=e.l,_=e.r},e=>{z=e.L,E=e.d,R=e.e,P=e.f,N=e.u,I=e.g,O=e.h,T=e.i,U=e.j,D=e.k,M=e.l,A=e.m,F=e.n,J=e.o,$=e.p,B=e.q,V=e.t,q=e.v,G=e.w,K=e.x,Y=e.y,Z=e.M,H=e.z,W=e.A,Q=e.a,X=e.B,ee=e.C,te=e.D,ne=e.F,ae=e.G,se=e.H,le=e.I,re=e.J,oe=e.K,ie=e.N,ce=e.O,de=e.P,ue=e.Q,he=e.S,xe=e.T,ge=e.U,pe=e.V,je=e.W,me=e.X,be=e.Y,ve=e.r,fe=e.Z,ye=e._,Ce=e.$,we=e.b,ke=e.c,Se=e.a0,Le=e.E},e=>{_e=e.u},e=>{ze=e.P,Ee=e.a},e=>{Re=e.c}],execute:function(){var t=document.createElement("style");t.textContent="._row_1uk92_1{flex-wrap:wrap;align-items:flex-start}._row_1uk92_1>*{flex:1;min-width:calc(8.125rem * var(--mantine-scale))}._content_euz2o_1,._body_euz2o_7,._stepper-root_euz2o_14,._stepper-content_euz2o_21{display:flex;flex-direction:column;overflow:hidden}._step-body_euz2o_28{overflow-y:auto}\n/*$vite$:1*/",document.head.appendChild(t),e("default",(function(){const{t:e}=L(),t=P(),{isDataLoading:a}=N((e=>e.app)),[s,r]=_.useState(),[o,i]=_.useState(!1),[c,d]=_.useState(!1);return _.useEffect((()=>{const e=ve.storage.get(fe);if(e)try{const t=JSON.parse(e);Object.keys(t.lines).length>0&&Object.values(t.lines)[0].id&&(r(t),i(!0))}catch{Ce.error("<TicketView/>, unable to restore draft ticket",e)}}),[]),n.jsxs(we,{w:{base:"100%",sm:600},style:{alignSelf:"center"},children:[n.jsx(k,{visible:a}),n.jsxs(ke,{direction:"column",px:"xs",style:{overflowY:"auto"},children:[n.jsx(Oe,{}),n.jsx(Te,{}),n.jsx(De,{})]}),n.jsx(S,{}),n.jsx(Se,{children:n.jsxs(l,{flex:1,gap:"sm",children:[n.jsx(b,{variant:"default",onClick:()=>{ve.openApp({appId:"rmg-palette"})},children:e("Go back")}),n.jsx(b,{variant:"default",ml:"auto",onClick:()=>{t(ye()),ve.storage.remove(fe),ve.event(Le.RESET_TICKET,{})},children:e("Reset")}),n.jsx(b,{onClick:()=>d(!0),children:e("Submit")})]})}),n.jsx(Ve,{isOpen:o,onClose:()=>i(!1),incomingState:s}),n.jsx(Be,{isOpen:c,onClose:()=>d(!1)})]})}));const Pe={row:"_row_1uk92_1"},Ne=e=>{const{onUpdate:t,onLangSwitch:d,onRemove:u}=e,h=e.entries??[],{t:x}=L(),g=_e(),p=Object.entries(z).map((([e,t])=>({value:e,label:g(t),disabled:h.some((t=>t[0]===e))}))),j=()=>{const e=Object.keys(z).filter((e=>!h.find((t=>t[0]===e))))[0];t(e,"")};return n.jsx(a,{legend:x("Multi-languages"),children:h.map((([e,a],h,g)=>n.jsxs(s,{pt:4,align:"center","data-testid":"entry-card-stack-"+e,children:[n.jsxs(l,{gap:"xs",flex:1,grow:!0,children:[n.jsx(r,{size:"xs","aria-label":x("Language"),value:e,onChange:t=>d(e,t),data:p,searchable:!0}),n.jsx(o,{size:"xs","aria-label":x("Name"),placeholder:x("Enter name"),value:a,onChange:({currentTarget:{value:n}})=>t(e,n)})]}),n.jsxs(s,{ml:8,wrap:"nowrap",children:[h===g.length-1?n.jsx(i,{size:"sm",variant:"filled","aria-label":x("Add a name in another language"),title:x("Add a name in another language"),onClick:j,children:n.jsx(E,{})}):n.jsx(c,{w:22}),g.length>1&&n.jsx(i,{size:"sm",variant:"outline","aria-label":x("Remove this name"),title:x("Remove this name"),onClick:()=>u(e),ml:4,children:n.jsx(R,{})})]})]},h)))})};function Ie(e){return n.jsx(Ne,{...e})}function Oe(){const{t:e,i18n:t}=L(),a=_e(),s=P(),{countryList:r}=N((e=>e.app)),{country:i,newCountry:c,countryName:g,newCountryLangs:p}=N((e=>e.ticket));_.useEffect((()=>{if(i&&"new"!==i){const e=r.find((e=>e.id===i));e&&(s(I(i)),s(O(e.languages)))}}),[i]);const j=[{value:"",label:e("Please select..."),disabled:!0},...r.filter((e=>"UN"!==e.id)).map((e=>({value:e.id,label:a(e.name)}))).toSorted(((e,n)=>e.label.localeCompare(n.label,t.languages[0]))),{value:"new",label:e("Add a country/region...")}],m=Object.entries(z).map((([e,t])=>({value:e,label:a(t)})));return n.jsxs(T,{children:[n.jsx(U,{children:n.jsx(d,{order:2,size:"h4",children:e("Country/Region")})}),n.jsxs(u,{py:4,gap:"xs",children:[n.jsxs(l,{className:Pe.row,children:[n.jsx(h,{label:e("Country/Region"),value:i,onChange:({currentTarget:{value:e}})=>s(D(e)),data:j}),n.jsx(o,{label:e("Country/region code"),placeholder:"e.g. CN, HK, JP (ISO 3166-1 alpha-2)",value:c,onChange:({currentTarget:{value:e}})=>s(I(e)),error:c&&!c.match(/^[A-Z]{2}$|^GB[A-Z]{3}$/)?e("Country code should be in the format of ISO 3166-1 alpha-2"):void 0,disabled:"new"!==i}),n.jsx(x,{label:e("Official language"),value:p,onChange:e=>s(O(e)),data:m,searchable:!0,disabled:"new"!==i})]}),"new"===i&&n.jsx(Ie,{entries:g,onUpdate:(e,t)=>s(F({lang:e,name:t})),onLangSwitch:(e,t)=>s(A({prevLang:e,nextLang:t})),onRemove:e=>s(M(e))})]})]})}function Te(){const{t:e,i18n:t}=L(),a=P(),s=_e(),{cityList:r}=N((e=>e.app)),{country:i,city:c,newCity:x,cityName:g}=N((e=>e.ticket)),p=[{value:"",label:e("Please select..."),disabled:!0},...r.filter((e=>e.country===i)).map((e=>({value:e.id,label:s(e.name)}))).toSorted(((e,n)=>e.label.localeCompare(n.label,t.languages[0]))),{value:"new",label:e("Add a city")+"..."}];return n.jsxs(T,{children:[n.jsx(U,{children:n.jsx(d,{order:2,size:"h4",children:e("City")})}),n.jsxs(u,{py:4,gap:"xs",children:[n.jsxs(l,{align:"flex-start",grow:!0,children:[n.jsx(h,{label:e("City"),value:c,onChange:({currentTarget:{value:e}})=>(async e=>{if("new"===e)return void a(q("new"));const t=await G(e,r);a(t?K(t):Y())})(e),data:p}),"new"===c&&n.jsx(o,{label:e("City code"),placeholder:"e.g. hongkong, guangzhou, shanghai",value:x,onChange:({currentTarget:{value:e}})=>a(J(e)),error:x&&x.match(/[^a-z]/)?"City code should contain lower case letters only":void 0})]}),"new"===c&&n.jsx(Ie,{entries:g,onUpdate:(e,t)=>a(V({lang:e,name:t})),onLangSwitch:(e,t)=>a(B({prevLang:e,nextLang:t})),onRemove:e=>a($(e))})]})]})}function Ue({lineDetail:e,onUpdate:t,onMoveUp:a,onMoveDown:s,onCopy:r,onRemove:c,onNameUpdate:d,onNameRemove:h,onLangSwitch:x}){const{t:b}=L(),v=_e(),{pantoneReady:f}=N((e=>e.app)),[y,C]=_.useState(!!e.pantone),[w,k]=_.useState(!1),S=_.useRef(null),z=[{label:b("Black"),value:Z.black},{label:b("White"),value:Z.white}],E=e.fg===Z.black?"black":"white";return n.jsxs(g,{ref:S,className:Re.editable,p:"sm",withBorder:!0,children:[n.jsxs(g.Section,{bg:e.colour,p:"sm",className:Re["card-section"],children:[n.jsx(p,{span:!0,style:{color:E},children:v(Object.fromEntries(e.nameEntity))}),n.jsxs(l,{gap:"xs",ml:"auto",children:[n.jsx(i,{size:"xs",variant:"subtle",color:E,"aria-label":b("Move up"),title:b("Move up"),onClick:a,children:n.jsx(H,{})}),n.jsx(i,{size:"xs",variant:"subtle",color:E,"aria-label":b("Move down"),title:b("Move down"),onClick:s,children:n.jsx(W,{})}),n.jsx(i,{size:"xs",variant:"subtle",color:E,"aria-label":b("Edit"),title:b("Edit"),onClick:()=>{w?k(!1):(k(!0),setTimeout((()=>{S.current?.scrollIntoView({behavior:"smooth"})}),0))},children:n.jsx(Q,{})}),n.jsx(i,{size:"xs",variant:"subtle",color:E,"aria-label":b("Duplicate"),title:b("Duplicate"),onClick:r,children:n.jsx(X,{})}),n.jsx(i,{size:"xs",variant:"subtle",color:E,"aria-label":b("Remove"),title:b("Remove"),onClick:c,children:n.jsx(R,{})})]})]}),w&&n.jsxs(u,{gap:"xs",mt:"xs",children:[n.jsxs(l,{gap:"xs",className:Re["editable-group"],children:[n.jsx(o,{label:b("Line code"),placeholder:"e.g. twl, gz1, sh1",value:e.id,onChange:({currentTarget:{value:e}})=>t?.({id:e}),error:e.id?.match(/[^a-z0-9]/)?b("Line code should be alphanumeric"):void 0}),n.jsx(j,{label:b("Background colour"),value:e.colour,onChange:e=>t?.({colour:e}),disabled:f&&y}),f&&n.jsx(m,{label:b("Use PantoneÂ®"),checked:y,onChange:({currentTarget:{checked:e}})=>C(e),mt:"xl"}),f&&y&&n.jsx(ze,{value:e.pantone??"",onChange:(e,n)=>t?.({pantone:e,colour:n})}),n.jsx(ee,{size:"sm",label:b("Foreground colour"),data:z,value:e.fg,onChange:e=>t?.({fg:e})})]}),n.jsx(Ie,{entries:e.nameEntity,onUpdate:(e,t)=>d?.(e,t),onLangSwitch:(e,t)=>x?.(e,t),onRemove:e=>h?.(e)})]})]})}function De(){const{t:e}=L(),t=P(),a=N((e=>e.ticket.lines)),s=_.useRef(null),l=_.useCallback((()=>{setTimeout((()=>{s.current?.lastElementChild?.scrollIntoView({behavior:"smooth"})}),0)}),[s.current]);return n.jsxs(T,{children:[n.jsxs(U,{children:[n.jsx(d,{order:2,size:"h4",children:e("Lines")}),n.jsx(Ee,{ml:"auto"})]}),n.jsxs(u,{ref:s,py:4,gap:"xs",children:[Object.entries(a).map((([e,a])=>n.jsx(Ue,{lineDetail:a,onUpdate:n=>t(oe({entryId:e,updates:n})),onMoveUp:()=>t(re(e)),onMoveDown:()=>t(le(e)),onCopy:()=>(e=>{t(ie(e)),l()})(e),onRemove:()=>t(se(e)),onNameUpdate:(n,a)=>t(ae({entryId:e,lang:n,name:a})),onLangSwitch:(n,a)=>t(ne({entryId:e,prevLang:n,nextLang:a})),onNameRemove:n=>t(te({entryId:e,lang:n}))},e))),n.jsx(b,{size:"xs",variant:"outline",leftSection:n.jsx(E,{}),ml:"auto",onClick:()=>{t(ce()),l()},children:e("Add a line")})]})]})}const Me={content:"_content_euz2o_1",body:"_body_euz2o_7","stepper-root":"_stepper-root_euz2o_14","stepper-content":"_stepper-content_euz2o_21","step-body":"_step-body_euz2o_28"};function Ae(e){const{countryErrors:t,cityErrors:a,lineErrors:s,onIgnore:r,onClose:o}=e,{t:i}=L(),c=_e();return n.jsxs(n.Fragment,{children:[n.jsxs(u,{gap:"xs",className:Me["step-body"],children:[n.jsx(p,{children:i("Your inputs contain the following errors. Please consider fixing it before submitting.")}),t.length>0&&n.jsxs(n.Fragment,{children:[n.jsx(d,{order:3,size:"h5",children:i("Country/Region")}),n.jsx(v,{size:"sm",withPadding:!0,"aria-label":"List of country errors",children:t.map(((e,t)=>n.jsx(v.Item,{children:c(de[e])},t)))})]}),a.length>0&&n.jsxs(n.Fragment,{children:[n.jsx(d,{order:3,size:"h5",children:i("City")}),n.jsx(v,{size:"sm",withPadding:!0,"aria-label":"List of city errors",children:a.map(((e,t)=>n.jsx(v.Item,{children:c(de[e])},t)))})]}),Object.values(s).flat().length>0&&n.jsxs(n.Fragment,{children:[n.jsx(d,{order:3,size:"h5",children:i("Lines")}),n.jsx(v,{size:"sm",withPadding:!0,"aria-label":"List of line errors",children:Object.entries(s).map((([e,t])=>n.jsxs(v.Item,{children:[e,n.jsx(v,{size:"sm",withPadding:!0,children:t.map(((e,t)=>n.jsx(v.Item,{children:c(de[e])},t)))})]},e)))})]})]}),n.jsxs(l,{gap:"sm",pt:"xs",children:[n.jsx(b,{variant:"default",ml:"auto",onClick:o,children:i("Go back")}),n.jsx(b,{onClick:r,children:i("Submit anyway")})]})]})}const Fe=e=>!!e.match(/^https?:\/\//)?.[0];function Je(e){const{dataSource:t,onDataSourceChange:a,refLink:s,onRefLinkChange:r,justification:i,onJustificationChange:c,onPrev:d,onNext:x}=e,{t:g}=L(),j=_e(),m=[{value:"",label:g("Please select..."),disabled:!0},...Object.entries(ue).map((([e,t])=>({value:e,label:j(t)})))],v=!(t&&s&&i&&Fe(s));return n.jsxs(n.Fragment,{children:[n.jsxs(u,{gap:"xs",className:Me["step-body"],children:[n.jsx(p,{children:g("Please provide suitable source and justification.")}),n.jsx(h,{label:g("Data source"),value:t,onChange:({currentTarget:{value:e}})=>a(e),data:m}),n.jsx(o,{label:g("Reference link"),placeholder:g("Enter a valid URL, e.g.")+" https://en.wikipedia.org",value:s,onChange:({currentTarget:{value:e}})=>r(e),error:s&&!Fe(s)?g("URL is invalid"):void 0}),n.jsx(f,{label:g("Justification"),placeholder:g("Briefly describe your changes and provide justification"),value:i,onChange:({currentTarget:{value:e}})=>c(e),autosize:!0,minRows:3})]}),n.jsxs(l,{gap:"sm",pt:"xs",children:[d&&n.jsx(b,{variant:"default",onClick:d,leftSection:n.jsx(he,{}),children:g("Previous")}),n.jsx(b,{ml:"auto",onClick:x,rightSection:n.jsx(xe,{}),disabled:v,children:g("Next")})]})]})}function $e(e){const{countryEntry:t,cityEntry:a,paletteList:s,dataSource:r,refLink:o,justification:i,onPrev:c}=e,{t:d}=L(),h=_e(),x=_.useRef(null),g=[`**Data source:** ${r?h(ue[r]):"(REPLACE ME)"}`,`**Reference link:** ${o||"(REPLACE ME)"}`,`**Justification:** ${i||"(REPLACE ME)"}`,ge,pe("country",t),pe("city",a),pe("lines",s)].join("\n\n"),j=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+a?.name?.en,body:g}),m=new URLSearchParams({template:"new-palettes-request.md",labels:"resources",title:"Resources: New palettes of "+a?.name?.en});return n.jsxs(n.Fragment,{children:[n.jsxs(u,{gap:"xs",className:Me["step-body"],children:[n.jsx(p,{children:d("If the button below doesn't work for you, please follow the instructions below:")}),n.jsxs(v,{type:"ordered",withPadding:!0,children:[n.jsxs(v.Item,{children:[d("Open")," ",n.jsxs(y,{href:"https://github.com/railmapgen/rmg-palette/issues/new?"+m.toString(),target:"_blank",children:["Issue: New Palettes Request ",n.jsx(je,{})]})]}),n.jsxs(v.Item,{children:[d("Paste following text to the issue body")," ",n.jsx(b,{size:"xs",variant:"light",leftSection:n.jsx(X,{}),onClick:async()=>{x?.current&&(x.current.select(),await navigator.clipboard.writeText(g))},children:d("Copy")}),n.jsx(f,{ref:x,readOnly:!0,defaultValue:g,onClick:({target:e})=>e.select(),mt:"xs",autosize:!0,maxRows:3})]})]})]}),n.jsxs(l,{gap:"sm",pt:"xs",children:[n.jsx(b,{variant:"default",onClick:c,leftSection:n.jsx(he,{}),children:d("Previous")}),n.jsx(b,{ml:"auto",onClick:()=>window.open("https://github.com/railmapgen/rmg-palette/issues/new?"+j.toString(),"_blank"),children:d("1-click open issue")})]})]})}function Be(e){const{isOpen:t,onClose:a}=e,{t:s}=L(),[l,r]=_.useState([]),[o,i]=_.useState([]),[c,d]=_.useState({}),[u,h]=_.useState(""),[x,g]=_.useState(""),[p,j]=_.useState(""),[m,b]=_.useState(!1),[v,f]=_.useState(!1),{countryList:y}=N((e=>e.app)),k=N((e=>e.ticket)),S=me.getCountryEntry(k),z=me.getCityEntry(k),E=me.getPalettes(k);_.useEffect((()=>{t?(r(me.getCountryErrors(k)),i(me.getCityErrors(k,y)),d(me.getLineErrors(k,y))):(b(!1),h(""),g(""),j(""),f(!1))}),[t]);const R=l.length>0||o.length>0||Object.values(c).flat().length>0,P=R&&!m,I=!P&&!v;return n.jsx(C,{classNames:{content:Me.content,body:Me.body},opened:t,onClose:()=>{P||I||ve.storage.remove(fe),a()},title:s("Submit palettes"),children:n.jsxs(w,{active:P?0:I?1:2,classNames:{root:Me["stepper-root"],content:Me["stepper-content"]},children:[n.jsx(w.Step,{label:s("Validate"),color:m?"orange":void 0,completedIcon:m?n.jsx(be,{size:24}):void 0,children:n.jsx(Ae,{countryErrors:l,cityErrors:o,lineErrors:c,onIgnore:()=>b(!0),onClose:a})}),n.jsx(w.Step,{label:s("Justify"),children:n.jsx(Je,{dataSource:u,onDataSourceChange:h,refLink:x,onRefLinkChange:g,justification:p,onJustificationChange:j,onPrev:R?()=>b(!1):void 0,onNext:()=>f(!0)})}),n.jsx(w.Step,{label:s("Submit"),children:n.jsx($e,{countryEntry:S,cityEntry:z,paletteList:E,dataSource:u,refLink:x,justification:p,onPrev:()=>f(!1)})})]})})}function Ve(e){const{isOpen:t,onClose:a,incomingState:r}=e,{t:o}=L(),i=P();return n.jsx(C,{opened:t,onClose:a,title:o("Unsaved draft"),children:n.jsxs(s,{direction:"column",children:[n.jsx(p,{children:o("Do you want to continue with your last unsaved ticket?")}),n.jsxs(l,{gap:"xs",mt:"xs",children:[n.jsx(b,{variant:"default",ml:"auto",onClick:()=>{ve.storage.remove(fe),a()},children:o("Discard")}),n.jsx(b,{onClick:()=>{r&&i(ye(r)),a()},children:o("Continue")})]})]})})}}}}));
