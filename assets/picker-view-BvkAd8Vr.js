import{j as e,o as V,a0 as T,u as U,v as W,T as G,G as w,B as I,a1 as K,a2 as Y,a3 as J,r as R,m as X,w as q,F as Q,H as N,_ as Z,$ as ee,k as te,L as ne}from"./mantine-D6eU2gBs.js";import{l as A,r as h,o as oe}from"./react-ZLv5tWbY.js";import{u as M,M as L,a as z,H as se,E as P,J as ae,K as le}from"./index-rLJIADUm.js";import{u as $}from"./use-translated-name-CiDU2zOs.js";import{u as re}from"./use-palette-Dtkn3VJ8.js";import{a as ce,P as ie,C as ue}from"./compatible-colour-input-Bpge8f3I.js";const de="_body_jalou_1",B={body:de,"custom-input-group":"_custom-input-group_jalou_8"},pe="_countryName_bew9y_1",me={countryName:pe};function Ce(g){const{defaultValueId:n,onChange:p}=g,{t:b,i18n:f}=A(),{translateName:r}=$(),{countryList:j,cityList:m}=M(t=>t.app),d=m.reduce((t,c)=>({...t,[c.id]:c}),{}),o=j.reduce((t,c)=>({...t,[c.id]:c}),{}),u=n&&n in d?n:null,C=({option:t})=>{const c=d[t.value],s=c?o[c.country]:null;return c&&s&&e.jsxs("div",{children:[e.jsx("div",{children:r(c.name)}),e.jsx("div",{className:me.countryName,children:r(s.name)})]})},a=({options:t,search:c})=>{const s=c.toLocaleLowerCase();return t.filter(i=>{const v=d[i.value];return v&&(v.id.toLocaleLowerCase().includes(s)||Object.values(v.name).some(y=>y.toLocaleLowerCase().includes(s))||v.country.toLocaleLowerCase().includes(s)||Object.values(o[v.country]?.name??{}).some(y=>y.toLocaleLowerCase().includes(s)))})},x=m.map(t=>({value:t.id,label:r(t.name)})).sort((t,c)=>t.value==="other"?1:c.value==="other"?-1:t.label.localeCompare(c.label,f.languages[0]));return e.jsx(V,{label:b("City"),data:x,value:u,onChange:t=>t&&p?.(t),renderOption:C,searchable:!0,filter:a})}function he(g){const{city:n,defaultValueId:p,onChange:b,onSubmit:f}=g,{t:r}=A(),{translateName:j}=$(),[m,d]=h.useState(!1),o=re(n),u=o.reduce((s,i)=>({...s,[i.id]:i}),{}),C=p&&p in u?p:null,a=s=>{if(s){const i=u[s];b?.(i.id,i.colour,i.fg||L.white,i.pantone)}},x=({option:s})=>{const i=u[s.value];return i&&e.jsx(T,{size:"lg",radius:"sm",color:i.colour,style:{color:i.fg||L.white},children:j(i.name)})},t=({options:s,search:i})=>{const v=i.toLocaleLowerCase();return s.filter(y=>{const S=u[y.value];return S&&(S.id.toLocaleLowerCase().includes(v)||Object.values(S.name).some(_=>_.toLocaleLowerCase().includes(v)))})},c=o.map(s=>({value:s.id,label:j(s.name)}));return e.jsx(V,{label:r("Line"),data:c,value:C,onChange:a,renderOption:x,searchable:!0,filter:t,onDropdownOpen:()=>d(!0),onDropdownClose:()=>d(!1),onKeyDown:({key:s})=>!m&&s==="Enter"&&f?.(),disabled:!n})}function ge({onApply:g}){const{t:n}=A(),p=z(),{recentlyUsed:b}=M(o=>o.app),[f,r]=h.useState(!1),j=n(f?"Remove":"Apply"),m=o=>{p(se(o)),R.event(P.REMOVE_HISTORY_ITEM,{})},d=()=>{p(ae()),R.event(P.CLEAR_HISTORY,{})};return e.jsxs(U,{w:"100%",children:[e.jsxs(W,{children:[e.jsx(G,{order:2,size:"h4",children:n("Recently used")}),e.jsx(w,{gap:"xs",ml:"auto",children:f?e.jsxs(e.Fragment,{children:[e.jsx(I,{variant:"default",size:"xs",onClick:d,children:n("Clear all")}),e.jsx(I,{size:"xs",onClick:()=>r(!1),children:n("Done")})]}):e.jsx(I,{variant:"default",size:"xs",onClick:()=>r(!0),children:n("Clear")})})]}),e.jsx(K,{children:e.jsx(w,{gap:"xs",p:"xs",children:b.map(({theme:o,displayName:u},C)=>e.jsx(Y,{bg:o[2],fg:o[3],"aria-label":j+" "+u,title:j+" "+u,onClick:()=>f?m(C):g(o),children:f?e.jsx(J,{}):"Aa"},o.join("-")))})})]})}const fe=g=>!!g.match(/^#[0-9a-fA-F]{6}$/);function xe(g){const{defaultTheme:n,sessionId:p,onSubmit:b,onClose:f}=g,{t:r}=A(),{pantoneReady:j}=M(l=>l.app),[m,d]=h.useState(n?.[0]),[o,u]=h.useState(n?.[1]),[C,a]=h.useState(n?.[2]||"#AAAAAA"),[x,t]=h.useState(n?.[3]||L.white),[c,s]=h.useState(""),[i,v]=h.useState("rgb"),y=()=>{s(""),v(l=>l==="pantone"?"rgb":l)};h.useEffect(()=>{p&&n&&(d(n[0]),u(n[1]),a(n[2]),t(n[3]),y())},[p,n?.toString()]);const S=[{label:r("RGB"),value:"rgb"},{label:r("PantoneÂ®"),value:"pantone",disabled:!j}],_=[{label:r("Black"),value:L.black},{label:r("White"),value:L.white}],O=m&&o&&C&&x&&fe(C),k=()=>{if(O){const l=`${m} - ${o}`,E=C.toLowerCase();b?.([m,o,E,x],l)}},F=l=>{d(l[0]),u(l[1]),a(l[2]),t(l[3]),y()};return e.jsxs(e.Fragment,{children:[e.jsx(X,{children:e.jsxs(q,{className:B.body,children:[e.jsx(Q,{children:e.jsx(T,{size:"xl",radius:"sm",color:C,style:{color:x},children:r("Example")})}),e.jsxs(w,{w:"100%",grow:!0,children:[e.jsx(Ce,{defaultValueId:m,onChange:l=>{d(l),u(void 0),a("#AAAAAA"),t(L.white)}}),e.jsx(he,{city:m,defaultValueId:o,onChange:(l,E,H,D)=>{u(l),a(E),t(H),D&&s(D)},onSubmit:k})]}),e.jsx(ce,{display:"none"}),e.jsxs(w,{w:"100%",className:B["custom-input-group"],children:[e.jsx(N,{size:"sm",label:r("Input mode"),data:S,value:i,onChange:l=>v(l)}),i==="pantone"&&e.jsx(ie,{value:c,onChange:(l,E)=>{d("other"),u("other"),a(E),s(l)}}),i!=="pantone"&&e.jsx(ue,{label:r("Background colour"),value:C,onChange:l=>{d("other"),u("other"),a(l),y()}}),e.jsx(N,{size:"sm",label:r("Foreground colour"),data:_,value:x,onChange:l=>{d("other"),u("other"),t(l)}})]}),e.jsx(ge,{onApply:F})]})}),e.jsx(Z,{}),e.jsx(ee,{children:e.jsxs(w,{ml:"auto",gap:"sm",children:[e.jsx(I,{variant:"default",size:"sm",onClick:f,children:r("Cancel")}),e.jsx(I,{variant:"filled",size:"sm",onClick:k,disabled:!O,children:r("Confirm")})]})})]})}const je="rmg-palette-bridge--";function we(){const[g]=oe(),n=g.get("parentId"),p=g.get("parentComponent"),b=z(),{isDataLoading:f}=M(a=>a.app),[r,j]=h.useState(),[m,d]=h.useState(),o=h.useRef(null);h.useEffect(()=>{const a=new BroadcastChannel(je+n);return o.current=a,R.event(P.APP_CLIP_VIEW_OPENED,{parentComponent:p}),a.onmessage=x=>{const{event:t,data:c}=x.data;console.log(`[${a.name}] Received event from parent component:`,t),t==="OPEN"&&(j(crypto.randomUUID()),d(c))},console.log(`[${a.name}] App clip connection established, parentComponent=${p}`),a.postMessage({event:"LOADED"}),()=>{a.close()}},[]);const u=(a,x)=>{console.log(`[${o.current?.name}] Emitting SELECT event, theme:`,a),o.current?.postMessage({event:"SELECT",data:a}),b(le({theme:a,displayName:x})),R.event(P.APP_CLIP_VIEW_SELECT,{parentComponent:p,theme:a})},C=()=>{console.log(`[${o.current?.name}] Emitting CLOSE event`),o.current?.postMessage({event:"CLOSE"}),R.event(P.APP_CLIP_VIEW_CLOSED,{parentComponent:p})};return e.jsxs(te,{children:[e.jsx(ne,{visible:f}),e.jsx(xe,{defaultTheme:m,sessionId:r,onSubmit:u,onClose:C})]})}export{we as default};
